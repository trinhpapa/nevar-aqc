function setDatePicker(){$("#datePickerTest").datepicker({minDate:todayFull,value:todayDateVN,uiLibrary:"bootstrap4",format:"dd/mm/yyyy"});$("#datePickerCalibration").datepicker({minDate:todayFull,value:todayDateVN,uiLibrary:"bootstrap4",format:"dd/mm/yyyy"});$("#created-time-filter").datepicker({uiLibrary:"bootstrap4",format:"dd/mm/yyyy"});$("#result-day-filter").datepicker({uiLibrary:"bootstrap4",format:"dd/mm/yyyy"})}function removeInvoiceAsync(n){$.confirm({message:"Xác nhận hủy phiếu này?",onOk:function(){let t=$(n).attr("data-invoice");receptionDepartment.ajaxRequest.removeInvoiceAsync(t)}})}$(function(){if(window.localStorage.getItem("user-profile")!==null){let n=JSON.parse(window.localStorage.getItem("user-profile")).functionKeys;n.includes(105)===!0&&$(receptionDepartment.htmlTag.summaryOfInvoice).show()}window.sessionStorage.getItem("customer-list")===null&&receptionDepartment.ajaxRequest.getCustomerList();window.sessionStorage.getItem("requirement-type-list")===null&&receptionDepartment.ajaxRequest.getRequirementTypeList();window.sessionStorage.getItem("test-object-list")===null&&receptionDepartment.ajaxRequest.getTestObjectList();window.sessionStorage.getItem("test-property-list")===null&&receptionDepartment.ajaxRequest.getTestPropertyList();window.sessionStorage.getItem("test-method-list")===null&&receptionDepartment.ajaxRequest.getTestMethodList();window.sessionStorage.setItem("summary-mode","false");window.sessionStorage.setItem("reception-table-mode","normal");receptionDepartment.ajaxRequest.getInvoiceAsync(1,null,null,null,null,null,null,!0);setDatePicker();$(receptionDepartment.htmlTag.testField).select2({theme:"bootstrap-sm",width:"100%"})});$(receptionDepartment.htmlTag.filterTable).click(function(){receptionDepartment.bindingData.requirementTypeFilterSelect();$(".filter-content").css("display","flex")});$(receptionDepartment.htmlTag.filterTableCancel).click(function(){$("#requirement-filter").val(0);$("#created-time-filter").val("");$("#result-day-filter").val("");$("#status-filter").val(0);window.sessionStorage.getItem("summary-mode")==="false"&&(window.sessionStorage.setItem("reception-table-mode","normal"),receptionDepartment.ajaxRequest.getInvoiceAsync(1,null,null,null,null,null,null,!0));window.sessionStorage.getItem("summary-mode")==="true"&&(window.sessionStorage.setItem("reception-table-mode","normal"),receptionDepartment.ajaxRequest.getSummaryAsync(1,null,null,null,null,null,null,!0))});$(receptionDepartment.htmlTag.searchFilterForm).submit(function(n){n.preventDefault();let t=1,i=15,r=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);window.sessionStorage.getItem("summary-mode")==="false"&&(window.sessionStorage.setItem("reception-table-mode","search"),receptionDepartment.ajaxRequest.getInvoiceAsync(t,i,null,null,null,null,r,!0));window.sessionStorage.getItem("summary-mode")==="true"&&(window.sessionStorage.setItem("reception-table-mode","search"),receptionDepartment.ajaxRequest.getSummaryAsync(t,i,null,null,null,null,r,!0))});$(receptionDepartment.htmlTag.filterTableAction).click(function(){let n=1,t=15,i=$("#requirement-filter").val(),r=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",n);window.sessionStorage.getItem("summary-mode")==="false"&&(window.sessionStorage.setItem("reception-table-mode","fill"),receptionDepartment.ajaxRequest.getInvoiceAsync(n,t,i,r,u,f,null,!0));window.sessionStorage.getItem("summary-mode")==="true"&&(window.sessionStorage.setItem("reception-table-mode","fill"),receptionDepartment.ajaxRequest.getSummaryAsync(n,t,i,r,u,f,null,!0))});$(document).on("click",receptionDepartment.htmlTag.editRow,function(){$(receptionDepartment.htmlTag.modalRequirementForm).modal()});receptionDepartment.htmlTag.modalRequirementForm.on("show.bs.modal",function(){receptionDepartment.handleEvent.resetForm();receptionDepartment.handleEvent.enableForm();receptionDepartment.handleEvent.setCustomerAutoComplete();receptionDepartment.handleEvent.disablePrintMode();receptionDepartment.bindingData.requirementTypeSelect();receptionDepartment.bindingData.formInputFromRequirementType($(receptionDepartment.htmlTag.selectRequirementType))});receptionDepartment.htmlTag.modalTestProperty.on("show.bs.modal",function(n){$(n.relatedTarget).attr("data-mode","property");$(receptionDepartment.htmlTag.tableTestProperty).empty();let t=$(n.relatedTarget).parents("tr").find("select.test-object").val();if($(receptionDepartment.htmlTag.addTestProperty).attr("data-object",t),$(n.relatedTarget).attr("data-property")!==undefined){let i=JSON.parse(decodeURIComponent($(n.relatedTarget).attr("data-property")));$.each(i,function(n,i){receptionDepartment.handleEvent.addTestPropertyItem(t,i.TestPropertyId,i.TestMethodId)})}});$(receptionDepartment.htmlTag.addTestProperty).click(function(n){n.preventDefault();receptionDepartment.handleEvent.addTestPropertyItem($(this).attr("data-object"))});$(receptionDepartment.htmlTag.updateTestProperty).click(function(n){n.preventDefault();$(receptionDepartment.htmlTag.testRequirementForm+" .table tbody").find("a[data-mode='property']").attr("data-property",encodeURIComponent(JSON.stringify(receptionDepartment.handleEvent.claimTestPropertyData()))).removeAttr("data-mode").find(".count-property").text(receptionDepartment.handleEvent.claimTestPropertyData().length)});receptionDepartment.htmlTag.modalPrintInvoice.on("shown.bs.modal",function(n){let t=$(n.relatedTarget).data("invoice");receptionDepartment.htmlTag.modalPrintInvoice.find(".modal-body").LoadingContent();receptionDepartment.ajaxRequest.getListEditionByInvoiceNo(t).done(function(n){receptionDepartment.htmlTag.modalPrintInvoice.find(".modal-body").empty();for(let i=0;i<=n;i++)i===0?receptionDepartment.htmlTag.modalPrintInvoice.find(".modal-body").append('<a href="/receptiondepartment/requirementinvoicereport/?no='+encodeURIComponent(t)+"&edition="+i+'" target="_blank" class="btn btn-outline-primary btn-lg btn-block"><i class="fa fa-file-excel"><\/i>Phiếu gốc<\/a>'):receptionDepartment.htmlTag.modalPrintInvoice.find(".modal-body").append('<a href="/receptiondepartment/requirementinvoicereport/?no='+encodeURIComponent(t)+"&edition="+i+'" target="_blank" class="btn btn-outline-primary btn-lg btn-block"><i class="fa fa-file-excel"><\/i>Phiếu chỉnh sửa lần '+i+"<\/a>")}).fail(function(n){console.log(n.responseText)})});$(document).on("click",receptionDepartment.htmlTag.TestPropertyItemRemove,function(){$(this).parents("tr").remove()});$(receptionDepartment.htmlTag.selectRequirementType).change(function(){receptionDepartment.handleEvent.resetForm();receptionDepartment.bindingData.formInputFromRequirementType(this)});$(receptionDepartment.htmlTag.resetFormTag).click(function(n){n.preventDefault();receptionDepartment.handleEvent.resetForm()});$(receptionDepartment.htmlTag.submitFormTag).click(function(n){n.preventDefault();$.confirm({message:"Xác nhận thêm phiếu?",onOk:function(){receptionDepartment.ajaxRequest.submitFormTRequirement()}})});$(document).on("click",receptionDepartment.htmlTag.testItemAdd,function(n){n.preventDefault();var t=!0;if($(this).parents("tr").find("a[data-property]").attr("data-property")===undefined||JSON.parse(decodeURIComponent($(this).parents("tr").find("a[data-property]").attr("data-property"))).length<1)return t=!1,toastr.error("Chưa chọn chỉ tiêu nào","Cảnh báo"),!1;$.each($(this).parents("tr").find("input.form-required"),function(n,i){if(i.value==="")return t=!1,toastr.error("Các trường không được để trống","Cảnh báo"),$(this).css("border","1px solid red"),$(this).focus(),!1;$(this).css("border","1px solid #ced4da")});t&&($(this).parents("tr").attr("data-confirm","true"),$(this).hide(),$(receptionDepartment.htmlTag.testItemRemove).show(),$(this).parents("tbody").append(receptionDepartment.htmlTag.testItemHtml).find(".test-object").select2({data:JSON.parse(window.sessionStorage.getItem("test-object-list")),theme:"bootstrap-sm",width:"200px",dropdownAutoWidth:!0}))});$(document).on("click",receptionDepartment.htmlTag.testItemRemove,function(){$(this).parents("tbody").find("tr").length>=2?$(this).parents("tr").remove():toastr.error("Không thể xóa","Lỗi")});$(document).on("click","#pagination-tag > li > button.link-number",function(n){n.preventDefault();let i=window.sessionStorage.getItem("reception-table-mode");$(receptionDepartment.htmlTag.paginationTag).find("li.active").removeClass("active");$(this).parent().addClass("active");let t=$(this).data("value"),r=15;if(window.sessionStorage.getItem("summary-mode")==="false"){if(i==="normal"&&receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,null,null,null,null,null,!0),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,n,i,u,f,null,!0)}}if(window.sessionStorage.getItem("summary-mode")==="true"){if(i==="normal"&&receptionDepartment.ajaxRequest.getSummaryAsync(t,r,null,null,null,null,null,!0),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,n,i,u,f,null,!0)}}});$(document).on("click","#pagination-tag > li > button.link-previous",function(n){n.preventDefault();let i=window.sessionStorage.getItem("reception-table-mode");$(receptionDepartment.htmlTag.paginationTag).find("li.active").removeClass("active");$(this).parent().addClass("active");let t=1,r=15;if(window.sessionStorage.getItem("summary-mode")==="false"){if(i==="normal"&&receptionDepartment.ajaxRequest.getInvoiceAsync(t),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,n,i,u,f,null,!0)}}if(window.sessionStorage.getItem("summary-mode")==="true"){if(i==="normal"&&receptionDepartment.ajaxRequest.getSummaryAsync(t),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,n,i,u,f,null,!0)}}});$(document).on("click","#pagination-tag > li > button.link-next",function(n){n.preventDefault();let i=window.sessionStorage.getItem("reception-table-mode");$(receptionDepartment.htmlTag.paginationTag).find("li.active").removeClass("active");$(this).parent().addClass("active");let t=$(receptionDepartment.htmlTag.paginationTag).data("pages"),r=15;if(window.sessionStorage.getItem("summary-mode")==="false"){if(i==="normal"&&receptionDepartment.ajaxRequest.getInvoiceAsync(t),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getInvoiceAsync(t,r,n,i,u,f,null,!0)}}else{if(i==="normal"&&receptionDepartment.ajaxRequest.getSummaryAsync(t),i==="search"){let n=$(receptionDepartment.htmlTag.searchContent).val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,null,null,null,null,n,!0)}if(i==="fill"){let n=$("#requirement-filter").val(),i=$("#created-time-filter").val(),u=$("#result-day-filter").val(),f=$("#status-filter").val();window.sessionStorage.setItem("tablePageIndex",t);receptionDepartment.ajaxRequest.getSummaryAsync(t,r,n,i,u,f,null,!0)}}});$(receptionDepartment.htmlTag.testField).change(function(){let n=parseInt($(receptionDepartment.htmlTag.testField).val());$(".test-object").empty();$(".test-object").select2({data:JSON.parse(window.sessionStorage.getItem("test-object-list")).where(function(t){return t.field===n}),theme:"bootstrap-sm",width:"200px",dropdownAutoWidth:!0})});$(document).on("click",receptionDepartment.htmlTag.copyProperty,function(n){n.preventDefault();let t=$(this).parents("tr").find(".data-property").attr("data-property");$.confirm({message:"Xác nhận copy dữ liệu?",onOk:function(){t===undefined?toastr.info("Không có chỉ tiêu nào!","Thông báo:"):(window.localStorage.setItem("property-copy",t),toastr.info("Copy dữ liệu chỉ tiêu thành công!","Thông báo:"))}})});$(document).on("click",receptionDepartment.htmlTag.pasteProperty,function(n){n.preventDefault();let t=window.localStorage.getItem("property-copy");var i=$(this);t===null||t==="undefined"?toastr.info("Dữ liệu chỉ tiêu trống!","Thông báo:"):$.confirm({message:"Xác nhận paste dữ liệu vào?",onOk:function(){i.parents("tr").find(".data-property").attr("data-property",t);i.parents("tr").find(".count-property").text(JSON.parse(decodeURIComponent(t)).length);toastr.info("Paste dữ liệu chỉ tiêu thành công!","Thông báo:")}})});$("#modal-test-update").on("shown.bs.modal",function(n){let t=$(n.relatedTarget).attr("data-id");$(receptionDepartment.htmlTag.submitTestUpdate).attr("data-id",t);$("#modal-test-update .modal-body").LoadingContent();receptionDepartment.ajaxRequest.getInvoiceByIdForUpdateAsync(t).done(function(n){$("#modal-test-update .modal-body").html(n)}).fail(function(n){console.error(n);toastr.error("Xảy ra lỗi, thử lại sau!","Thông báo:")})});$(receptionDepartment.htmlTag.submitTestUpdate).click(function(){$(receptionDepartment.htmlTag.cancelTestUpdate).attr("disabled",!0);$(receptionDepartment.htmlTag.submitTestUpdate).buttonLoading("Đang xử lý, vui lòng chờ",!1);let n=receptionDepartment.handleEvent.claimTestRequirementUpdateData();n.Id=$(this).attr("data-id");console.log(n);$.confirm({message:"Xác nhận lưu chỉnh sửa phiếu?",onOk:function(){receptionDepartment.ajaxRequest.updateInvoiceAsync(n).done(function(){$(receptionDepartment.htmlTag.cancelTestUpdate).attr("disabled",!1);$(receptionDepartment.htmlTag.submitTestUpdate).buttonLoaded(!1);$(receptionDepartment.htmlTag.cancelTestUpdate).click();toastr.success("Cập nhật thành công!","Thông báo:")}).fail(function(n){$(receptionDepartment.htmlTag.cancelTestUpdate).attr("disabled",!1);$(receptionDepartment.htmlTag.submitTestUpdate).buttonLoaded(!1);console.log(n);toastr.error(n.responseText,"Thông báo:")})},onCancel:function(){$(receptionDepartment.htmlTag.cancelTestUpdate).attr("disabled",!1);$(receptionDepartment.htmlTag.submitTestUpdate).buttonLoaded(!1)}})});$(receptionDepartment.htmlTag.summaryOfInvoice).click(function(){window.sessionStorage.getItem("summary-mode")==="false"?($(this).removeClass("btn-success"),$(this).addClass("btn-danger"),$(this).html("<i class='fa fa-undo-alt'><\/i> Quay lại"),window.sessionStorage.setItem("summary-mode","true"),receptionDepartment.ajaxRequest.getSummaryAsync(1,null,null,null,null,null,null,!0)):($(this).removeClass("btn-danger"),$(this).addClass("btn-success"),$(this).html('<i class="fa fa-file-excel"><\/i> Tổng hợp phiếu'),window.sessionStorage.setItem("summary-mode","false"),receptionDepartment.ajaxRequest.getInvoiceAsync(1,null,null,null,null,null,null,!0))});