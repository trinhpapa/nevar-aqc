function HandleData(n){if(!n||n.length<1)throw"Data null";const t=n[0],i=n[n.length-1];if(t.month>1)for(let i=1;i<t.month;i++)n.push({month:i,year:t.year,testRequirement:null,calibrationRequirement:null});if(i.month<12)for(let t=i.month+1;t<=12;t++)n.push({month:t,year:i.year,testRequirement:null,calibrationRequirement:null});return n.orderBy(function(n){return n.month})}function GetLineStatisticAsync(){$.ajax({type:"GET",url:"/Statistic/LineStatisticAsync",success:function(n){n=HandleData(n);$("#line-title").html("Thống kê phiếu yêu cầu năm "+n[0].year);let t=document.getElementById("myChart"),i=new Chart(t,{type:"line",data:{labels:[1,2,3,4,5,6,7,8,9,10,11,12],datasets:[{data:n.map(n=>n.testRequirement),label:"Yêu cầu thử nghiệm",borderColor:"#FF6384",fill:!1},{data:n.map(n=>n.calibrationRequirement),label:"Yêu cầu hiệu chuẩn",borderColor:"#36A2EB",fill:!1}]},options:{scales:{xAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Tháng"}}],yAxes:[{display:!0,scaleLabel:{display:!0,labelString:"Số phiếu"}}]}}})}})}function GetLogLoginAsync(){$.ajax({type:"GET",url:"/SystemLog/GetLogLogin",success:function(n){$("#show-login-log").html("");$.each(n,function(n,t){let i=new Date(Date.parse(t.loginTime));$("#show-login-log").append('<div class="login-item">- <span class="login-username">'+t.username+'<\/span> đã đăng nhập lúc <span class="login-time"> '+ToJavaScriptFullDate(i)+"<\/span><\/div >")})}})}function HomeStatisticAsync(){$.ajax({type:"GET",url:"/Statistic/HomeStatisticAsync",success:function(n){let t=new CountUp("invoiceCount",n.invoiceCount),i=new CountUp("customerCount",n.customerCount),r=new CountUp("fieldCount",n.fieldCount),u=new CountUp("departmentCount",n.departmentCount);t.start();i.start();r.start();u.start()}})}window.onload=function(){HomeStatisticAsync();GetLogLoginAsync();GetLineStatisticAsync()};systemHub.on("userLogin",function(){GetLogLoginAsync()});