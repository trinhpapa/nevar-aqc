var roleManagement=function(){var n={bindingFunctionList:function(){let n=JSON.parse(window.sessionStorage.getItem("system-function"));$(roleManagement.htmlTag.systemFunctionList).html("");$.each(n,function(n,t){t.parent===null?$(roleManagement.htmlTag.systemFunctionList).append('<li class="expand '+t.key+'"><i class="fa fa-angle-right"><\/i><input type="checkbox" id="chk'+t.id+'" value="'+t.id+'" /><label >'+t.name+"<\/label><ul><\/ul><\/li>"):$(roleManagement.htmlTag.systemFunctionList).find("."+t.parent+"> ul").append('<li class="expand '+t.key+'"><i class="fa fa-angle-right"><\/i><input type="checkbox" id="chk'+t.id+'" value="'+t.id+'" /><label >'+t.name+"<\/label><ul><\/ul><\/li>")})}},t={getPagedAsync:function(n,t,i){$(roleManagement.htmlTag.contentData).LoadingTable();$.ajax({type:"POST",data:{pageIndex:n,pageSize:t,searchString:i},url:"/Role/GetPagedAsync",success:function(t){$(roleManagement.htmlTag.contentData).LoadedTable();$(roleManagement.htmlTag.contentData).html(t);$(roleManagement.htmlTag.paginationTag).paginationBinding(n,15)},error:function(n){throw"Get role error:"+n;}})},getAllSystemFunctionAsync:function(){$.ajax({type:"GET",url:"/Role/GetAllSystemFunction",success:function(n){window.sessionStorage.setItem("system-function",JSON.stringify(n))},error:function(n){throw"Get system function error:"+n;}})},createRoleAsync:function(){$(roleManagement.htmlTag.submitForm).buttonLoading();let n=roleManagement.handleEvent.claimFormData();$.ajax({type:"POST",data:n,url:"/Role/CreateAsync",success:function(){roleManagement.ajaxRequest.getPagedAsync(1,15,null);$(roleManagement.htmlTag.submitForm).buttonLoaded(!0);$(roleManagement.htmlTag.hideForm).click();toastr.success("Tạo role thành công","Thông báo:")},error:function(n){$(roleManagement.htmlTag.submitForm).buttonLoaded(!1);toastr.error(n.responseText,"Thông báo:")}})},deleteAsync:function(n){$.ajax({type:"POST",data:{Id:n},url:"/Role/DeleteAsync",success:function(){roleManagement.ajaxRequest.getPagedAsync(1,15,null);toastr.success("Xóa thành công","Thông báo:")},error:function(n){toastr.error(n.responseText,"Thông báo:")}})},getByIdAsync:function(n){$.ajax({type:"POST",data:{roleId:n},url:"/Role/GetByIdAsync",success:function(n){n=JSON.parse(n);$(roleManagement.htmlTag.roleName).val(n.Name);$.each(n.SYSRoleFunctionEntities,function(n,t){$("#system-function-list").find("input[type=checkbox]#chk"+t.FunctionId).prop("checked",!0)});$(roleManagement.htmlTag.roleNote).val(n.Note)},error:function(n){console.log(n.responseText)}})},updateAsync:function(n){$(roleManagement.htmlTag.updateForm).buttonLoading();let t=roleManagement.handleEvent.claimFormData();t.Id=n;$.ajax({type:"POST",data:t,url:"/Role/UpdateAsync",success:function(){roleManagement.ajaxRequest.getPagedAsync(1,15,null);$(roleManagement.htmlTag.updateForm).buttonLoaded(!0);$(roleManagement.htmlTag.hideForm).click();toastr.success("Cập nhật thành công","Thông báo:")},error:function(n){$(roleManagement.htmlTag.updateForm).buttonLoaded(!1);toastr.error(n.responseText,"Thông báo:")}})}},i={claimFormData:function(){let n=$(roleManagement.htmlTag.roleName).val();if(n.length<1){$(roleManagement.htmlTag.submitForm).buttonLoaded(!1);toastr.error("Tên không được để trống","Cảnh báo:");$(roleManagement.htmlTag.roleName).focus();throw"Role name is required";}let t=[];$.each($("#system-function-list").find("input[type=checkbox]:checked"),function(n,i){t.push({FunctionId:parseInt($(i).val())})});let i=$(roleManagement.htmlTag.roleNote).val();return{Name:n,SYSRoleFunctionEntities:t,Note:i}}};return{htmlTag:{contentData:"#content-data",paginationTag:"#pagination-tag",searchFilterForm:"#search-filter-form",searchFilterContent:"#search-filter",modalRoleForm:"#modal-role-form",roleForm:"#role-form",hideForm:"#hide-form",submitForm:"#submit-form",updateForm:"#update-form",roleName:"#role-name",roleNote:"#role-note",systemFunctionList:"#system-function-list"},bindingData:n,ajaxRequest:t,handleEvent:i}}();